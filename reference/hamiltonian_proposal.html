<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a new Hamiltonian proposal object. — hamiltonian_proposal • rmcmc</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a new Hamiltonian proposal object. — hamiltonian_proposal"><meta name="description" content="Returns a list with function to sample from the proposal, evaluate the log
density ratio for a state pair for the proposal and update the proposal
parameters. The proposal has two parameters scale and shape. At least one
of scale and shape must be set before sampling from the proposal or
evaluating the log density ratio."><meta property="og:description" content="Returns a list with function to sample from the proposal, evaluate the log
density ratio for a state pair for the proposal and update the proposal
parameters. The proposal has two parameters scale and shape. At least one
of scale and shape must be set before sampling from the proposal or
evaluating the log density ratio."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rmcmc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/barker-proposal.html">Robust gradient-based MCMC with the Barker proposal</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UCL/rmcmc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a new Hamiltonian proposal object.</h1>
      <small class="dont-index">Source: <a href="https://github.com/UCL/rmcmc/blob/main/R/hamiltonian.R" class="external-link"><code>R/hamiltonian.R</code></a></small>
      <div class="d-none name"><code>hamiltonian_proposal.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Returns a list with function to sample from the proposal, evaluate the log
density ratio for a state pair for the proposal and update the proposal
parameters. The proposal has two parameters <code>scale</code> and <code>shape</code>. At least one
of <code>scale</code> and <code>shape</code> must be set before sampling from the proposal or
evaluating the log density ratio.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hamiltonian_proposal</span><span class="op">(</span></span>
<span>  <span class="va">target_distribution</span>,</span>
<span>  <span class="va">n_step</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  shape <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_auxiliary <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">state</span><span class="op">$</span><span class="fu">dimension</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sample_n_step <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-target-distribution">target_distribution<a class="anchor" aria-label="anchor" href="#arg-target-distribution"></a></dt>
<dd><p>Target stationary distribution for chain. A list
with named entries <code>log_density</code> and <code>gradient_log_density</code> corresponding to
respectively functions for evaluating the logarithm of the (potentially
unnormalized) density of the target distribution and its gradient.
As an alternative to <code>gradient_log_density</code> an entry
<code>value_and_gradient_log_density</code> may instead be provided which is a function
returning both the value and gradient of the logarithm of the (unnormalized)
density of the target distribution as a list under the names <code>value</code> and
<code>gradient</code> respectively.</p></dd>


<dt id="arg-n-step">n_step<a class="anchor" aria-label="anchor" href="#arg-n-step"></a></dt>
<dd><p>Number of leapfrog steps to simulate Hamiltonian dynamics for
in each proposed move, or parameter passed to function specified by
<code>sample_n_step</code> argument if not <code>NULL</code>.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>Scale parameter of proposal distribution. A non-negative scalar
value determining scale of steps proposed.</p></dd>


<dt id="arg-shape">shape<a class="anchor" aria-label="anchor" href="#arg-shape"></a></dt>
<dd><p>Shape parameter of proposal distribution. Either a vector
corresponding to a diagonal shape matrix with per-dimension scaling
factors, or a matrix allowing arbitrary linear transformations.</p></dd>


<dt id="arg-sample-auxiliary">sample_auxiliary<a class="anchor" aria-label="anchor" href="#arg-sample-auxiliary"></a></dt>
<dd><p>A function which samples new values for auxiliary
variables (corresponding to a linear transform of momentum) given current
chain state, leaving their standard normal target distribution invariant.
Defaults to a function sampling independent standard normal random variates
but can be used to implement alternative updates such as partial momentum
refreshment. Function should accept a single argument which is passed the
current chain state.</p></dd>


<dt id="arg-sample-n-step">sample_n_step<a class="anchor" aria-label="anchor" href="#arg-sample-n-step"></a></dt>
<dd><p>Optionally a function which randomly samples number of
leapfrog steps to simulate in each proposed move from some integer-valued
distribution, or <code>NULL</code> (the default) to use a fixed deterministic number
of steps as specified by <code>n_step</code> argument. If a function it should accept
a single argument which will be passed the value of <code>n_step</code> which can
be used to specify parameter(s) of distribution to sample number of steps
from.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Proposal object. A list with entries</p><ul><li><p><code>sample</code>: a function to generate sample from proposal distribution given
current chain state,</p></li>
<li><p><code>log_density_ratio</code>: a  function to compute log density ratio for proposal
for a given pair of current and proposed chain states,</p></li>
<li><p><code>update</code>: a function to update parameters of proposal,</p></li>
<li><p><code>parameters</code>: a function to return list of current parameter values.</p></li>
<li><p><code>default_target_accept_prob</code>: a function returning the default target
acceptance rate to use for any scale adaptation.</p></li>
<li><p><code>default_initial_scale</code>: a function which given a dimension gives a default
value to use for the initial proposal scale parameter.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">target_distribution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  log_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  gradient_log_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="va">x</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Proposal with fixed number of leapfrog steps</span></span></span>
<span class="r-in"><span><span class="va">proposal</span> <span class="op">&lt;-</span> <span class="fu">hamiltonian_proposal</span><span class="op">(</span><span class="va">target_distribution</span>, scale <span class="op">=</span> <span class="fl">1.</span>, n_step <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="chain_state.html">chain_state</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.</span>, <span class="fl">0.</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">876287L</span>, <span class="va">proposed_state</span> <span class="op">&lt;-</span> <span class="va">proposal</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">log_density_ratio</span> <span class="op">&lt;-</span> <span class="va">proposal</span><span class="op">$</span><span class="fu">log_density_ratio</span><span class="op">(</span><span class="va">state</span>, <span class="va">proposed_state</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">proposal</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Proposal with number of steps randomly sampled uniformly from 5:10</span></span></span>
<span class="r-in"><span><span class="va">sample_uniform_int</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lower</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">-</span> <span class="va">lower</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">proposal</span> <span class="op">&lt;-</span> <span class="fu">hamiltonian_proposal</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">target_distribution</span>,</span></span>
<span class="r-in"><span>  scale <span class="op">=</span> <span class="fl">1.</span>,</span></span>
<span class="r-in"><span>  n_step <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sample_n_step <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_step</span><span class="op">)</span> <span class="fu">sample_uniform_int</span><span class="op">(</span><span class="va">n_step</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">n_step</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">876287L</span>, <span class="va">proposed_state</span> <span class="op">&lt;-</span> <span class="va">proposal</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Proposal with partial momentum refreshment</span></span></span>
<span class="r-in"><span><span class="va">partial_momentum_update</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">phi</span> <span class="op">=</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">momentum</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">$</span><span class="fu">momentum</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">momentum</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">state</span><span class="op">$</span><span class="fu">dimension</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span> <span class="op">*</span> <span class="va">momentum</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span> <span class="op">*</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">momentum</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">proposal</span> <span class="op">&lt;-</span> <span class="fu">hamiltonian_proposal</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">target_distribution</span>,</span></span>
<span class="r-in"><span>  scale <span class="op">=</span> <span class="fl">1.</span>,</span></span>
<span class="r-in"><span>  n_step <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  sample_auxiliary <span class="op">=</span> <span class="va">partial_momentum_update</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">876287L</span>, <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">proposed_state</span> <span class="op">&lt;-</span> <span class="va">proposal</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="va">state</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew M. Graham, Samuel Livingstone, Engineering and Physical Sciences Research Council.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>


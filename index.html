<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Robust Markov Chain Monte Carlo Methods • rmcmc</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Robust Markov Chain Monte Carlo Methods">
<meta name="description" content="Functions for simulating Markov chains using the Barker proposal to compute Markov chain Monte Carlo (MCMC) estimates of expectations with respect to a target distribution on a real-valued vector space. The Barker proposal, described in Livingstone and Zanella (2022) &lt;doi:10.1111/rssb.12482&gt;, is a gradient-based MCMC algorithm inspired by the Barker accept-reject rule. It combines the robustness of simpler MCMC schemes, such as random-walk Metropolis, with the efficiency of gradient-based methods, such as the Metropolis adjusted Langevin algorithm. The key function provided by the package is sample_chain(), which allows sampling a Markov chain with a specified target distribution as its stationary distribution. The chain is sampled by generating proposals and accepting or rejecting them using a Metropolis-Hasting acceptance rule. During an initial warm-up stage, the parameters of the proposal distribution can be adapted, with adapters available to both: tune the scale of the proposals by coercing the average acceptance rate to a target value; tune the shape of the proposals to match covariance estimates under the target distribution. As well as the default Barker proposal, the package also provides implementations of alternative proposal distributions, such as (Gaussian) random walk and Langevin proposals. Optionally, if BridgeStans R interface &lt;https://roualdes.us/bridgestan/latest/languages/r.html&gt;, available on GitHub &lt;https://github.com/roualdes/bridgestan&gt;, is installed, then BridgeStan can be used to specify the target distribution to sample from.">
<meta property="og:description" content="Functions for simulating Markov chains using the Barker proposal to compute Markov chain Monte Carlo (MCMC) estimates of expectations with respect to a target distribution on a real-valued vector space. The Barker proposal, described in Livingstone and Zanella (2022) &lt;doi:10.1111/rssb.12482&gt;, is a gradient-based MCMC algorithm inspired by the Barker accept-reject rule. It combines the robustness of simpler MCMC schemes, such as random-walk Metropolis, with the efficiency of gradient-based methods, such as the Metropolis adjusted Langevin algorithm. The key function provided by the package is sample_chain(), which allows sampling a Markov chain with a specified target distribution as its stationary distribution. The chain is sampled by generating proposals and accepting or rejecting them using a Metropolis-Hasting acceptance rule. During an initial warm-up stage, the parameters of the proposal distribution can be adapted, with adapters available to both: tune the scale of the proposals by coercing the average acceptance rate to a target value; tune the shape of the proposals to match covariance estimates under the target distribution. As well as the default Barker proposal, the package also provides implementations of alternative proposal distributions, such as (Gaussian) random walk and Langevin proposals. Optionally, if BridgeStans R interface &lt;https://roualdes.us/bridgestan/latest/languages/r.html&gt;, available on GitHub &lt;https://github.com/roualdes/bridgestan&gt;, is installed, then BridgeStan can be used to specify the target distribution to sample from.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">rmcmc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/adjusting-noise-distribution.html">Adjusting the noise distribution in the Barker proposal</a></li>
    <li><a class="dropdown-item" href="articles/barker-proposal.html">Robust gradient-based MCMC with the Barker proposal</a></li>
    <li><a class="dropdown-item" href="articles/interfacing-with-stan-models.html">Interfacing with Stan models via BridgeStan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UCL/rmcmc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rmcmc-robust-markov-chain-monte-carlo-methods">rmcmc: Robust Markov chain Monte Carlo methods<a class="anchor" aria-label="anchor" href="#rmcmc-robust-markov-chain-monte-carlo-methods"></a>
</h1></div>
<!-- badges: start -->

<p><code>rmcmc</code> is an R package for simulating Markov chains using the Barker proposal to compute <em>Markov chain Monte Carlo</em> (MCMC) estimates of expectations with respect to a target distribution on a real-valued vector space. The Barker proposal, described in <a href="https://doi.org/10.1111/rssb.12482" class="external-link">Livingstone and Zanella (2022)</a>, is a gradient-based MCMC algorithm inspired by the Barker accept-reject rule. It combines the robustness of simpler MCMC schemes, such as random-walk Metropolis, with the efficiency of gradient-based methods, such as the Metropolis adjusted Langevin algorithm.</p>
<p>The key function provided by the package is <code><a href="reference/sample_chain.html">sample_chain()</a></code>, which allows sampling a Markov chain with a specified target distribution as its stationary distribution. The chain is sampled by generating proposals and accepting or rejecting them using a Metropolis-Hasting acceptance rule. During an initial warm-up stage, the parameters of the proposal distribution can be adapted, with adapters available to both: tune the scale of the proposals by coercing the average acceptance rate to a target value; tune the shape of the proposals to match covariance estimates under the target distribution. As well as the default Barker proposal, the package also provides implementations of alternative proposal distributions, such as (Gaussian) random walk and Langevin proposals. Optionally, if <a href="https://roualdes.us/bridgestan/latest/languages/r.html" class="external-link">BridgeStan’s R interface</a>, available <a href="https://github.com/roualdes/bridgestan" class="external-link">on GitHub</a>, is installed, <a href="https://github-pages.ucl.ac.uk/rmcmc/articles/interfacing-with-stan-models.html" class="external-link">then BridgeStan can be used to specify the target distribution to sample from</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The latest published release version of <code>rmcmc</code> on CRAN can be installed using</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rmcmc"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the current development version of <code>rmcmc</code> can be installed using</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"UCL/rmcmc"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>The snippet below shows a basic example of using the package to generate samples from a normal target distribution with random scales. Adapters are used to tune the proposal scale to achieve a target average acceptance probability, and to tune the proposal shape with per-dimension scale factors based on online estimates of the target distribution variances.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/UCL/rmcmc" class="external-link">rmcmc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">876287L</span><span class="op">)</span></span>
<span><span class="va">dimension</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">scales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">target_distribution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  log_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="va">scales</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>  gradient_log_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="va">x</span> <span class="op">/</span> <span class="va">scales</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">proposal</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/barker_proposal.html">barker_proposal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sample_chain.html">sample_chain</a></span><span class="op">(</span></span>
<span>  target_distribution <span class="op">=</span> <span class="va">target_distribution</span>,</span>
<span>  initial_state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span>,</span>
<span>  n_warm_up_iteration <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n_main_iteration <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  proposal <span class="op">=</span> <span class="va">proposal</span>,</span>
<span>  adapters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/scale_adapter.html">scale_adapter</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="reference/shape_adapter.html">shape_adapter</a></span><span class="op">(</span><span class="st">"variance"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mean_accept_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span>, <span class="st">"accept_prob"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">adapted_shape</span> <span class="op">&lt;-</span> <span class="va">proposal</span><span class="op">$</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">shape</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Average acceptance probability is %.2f"</span>, <span class="va">mean_accept_prob</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"True target scales: %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">scales</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Adapter scale est.: %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="va">adapted_shape</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Average acceptance probability is 0.58</span></span>
<span><span class="co">#&gt; True target scales: 1.50538046096953, 1.37774732725824, 0.277038897322645</span></span>
<span><span class="co">#&gt; Adapter scale est.: 1.5328097767097, 1.42342707172926, 0.280359693392091</span></span></code></pre></div>
<p>As a second example, the snippet below demonstrates sampling from a two-dimensional banana shaped distribution based on the <a href="https://en.wikipedia.org/wiki/Rosenbrock_function" class="external-link">Rosenbrock function</a> and plotting the generated chain samples. Here we use the default values of the <code>proposal</code> and <code>adapters</code> arguments to <code><a href="reference/sample_chain.html">sample_chain()</a></code>, corresponding respectively to the Barker proposal, and adapters for tuning the proposal scale to coerce the average acceptance rate using a dual-averaging algorithm, and for tuning the proposal shape based on an estimate of the target distribution covariance matrix. The <code>target_distribution</code> argument to <code><a href="reference/sample_chain.html">sample_chain()</a></code> is passed a formula specifying the log density of the target distribution, which is passed to <code><a href="reference/target_distribution_from_log_density_formula.html">target_distribution_from_log_density_formula()</a></code> to construct necessary functions, using <code><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">stats::deriv()</a></code> to symbolically compute derivatives.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/UCL/rmcmc" class="external-link">rmcmc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">651239L</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sample_chain.html">sample_chain</a></span><span class="op">(</span></span>
<span>  target_distribution <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">8</span> <span class="op">-</span> <span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  initial_state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  n_warm_up_iteration <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n_main_iteration <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">traces</span><span class="op">[</span>, <span class="st">"x"</span><span class="op">]</span>, <span class="va">results</span><span class="op">$</span><span class="va">traces</span><span class="op">[</span>, <span class="st">"y"</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"#1f77b4"</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-banana-samples-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=rmcmc" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/UCL/rmcmc/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/UCL/rmcmc/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rmcmc</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Matthew M. Graham <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9104-7960" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Samuel Livingstone <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-7277-086X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Engineering and Physical Sciences Research Council <br><small class="roles"> Funder </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/UCL/rmcmc/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/UCL/rmcmc/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://github.com/UCL/rmcmc/actions/workflows/pkgdown.yaml" class="external-link"><img src="https://github.com/UCL/rmcmc/actions/workflows/pkgdown.yaml/badge.svg" alt="pkgdown"></a></li>
<li><a href="https://github.com/UCL/rmcmc/actions/workflows/lint.yaml" class="external-link"><img src="https://github.com/UCL/rmcmc/actions/workflows/lint.yaml/badge.svg" alt="lint"></a></li>
<li><a href="https://github.com/UCL/rmcmc/actions/workflows/pre-commit.yaml" class="external-link"><img src="https://github.com/UCL/rmcmc/actions/workflows/pre-commit.yaml/badge.svg" alt="pre-commit"></a></li>
<li><a href="https://app.codecov.io/github/UCL/rmcmc" class="external-link"><img src="https://codecov.io/github/UCL/rmcmc/graph/badge.svg?token=PL8557fpgT" alt="codecov"></a></li>
<li><a href="https://doi.org/10.5281/zenodo.14804043" class="external-link"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.14804043.svg" alt="DOI"></a></li>
<li><a href="https://joss.theoj.org/papers/b3d646dcf01299076e8a724ec8d909dc" class="external-link"><img src="https://joss.theoj.org/papers/b3d646dcf01299076e8a724ec8d909dc/status.svg" alt="JOSS-status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew M. Graham, Samuel Livingstone, Engineering and Physical Sciences Research Council.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
